<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs";

  mermaid.initialize({
    startOnLoad: false,
    securityLevel: "loose",
    theme: "default"
  });

  function renderMermaidBlocks() {
    const mermaidCodeBlocks = document.querySelectorAll("pre code.language-mermaid");

    mermaidCodeBlocks.forEach((codeBlock, index) => {
      const pre = codeBlock.closest("pre");
      if (!pre) return;

      const mermaidContainer = document.createElement("div");
      mermaidContainer.className = "mermaid";
      mermaidContainer.id = `mermaid-${index}`;
      mermaidContainer.textContent = codeBlock.textContent;

      pre.parentNode.replaceChild(mermaidContainer, pre);
    });

    mermaid.run({ querySelector: ".mermaid" });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", renderMermaidBlocks);
  } else {
    renderMermaidBlocks();
  }
</script>